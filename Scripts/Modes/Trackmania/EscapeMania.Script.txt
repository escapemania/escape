// #RequireContext CSmMode

#Extends "Libs/Nadeo/TMNext/TrackMania/Modes/TMNextBase.Script.txt"

#Include "TextLib" as TL
#Include "MathLib" as ML

#Const	CompatibleMapTypes						"Trackmania\\TM_Race,TM_Race,Trackmania\\EscapeManiaArena,EscapeManiaArena"
#Const	Version												"0.0.1"
#Const	ScriptName										"Modes/Trackmania/EscapeMania.Script.txt"

declare CSmMapLandmark[] G_SpawnLandmarks;

***Match_StartServer***
***
Race::UseCppRaceProgression(False);
***

***Match_StartMap***
***
G_SpawnLandmarks = [];
foreach (Landmark in MapLandmarks) {
	if (Landmark.PlayerSpawn != Null) {
		G_SpawnLandmarks.add(Landmark);
	}
}
assert(G_SpawnLandmarks.count > 0);
***

***Match_PlayLoop***
***
foreach (Player in Players) {
	if (Player.SpawnStatus == CSmPlayer::ESpawnStatus::NotSpawned) {
		SpawnPlayer (Player, Player.CurrentClan, 100, G_SpawnLandmarks[0].PlayerSpawn, Now);
	}
}
***

Void DoNothing() {}